
# 性能优化

## 大纲

- 网络优化
  1. DNS缓存
  2. http
     1. 减少请求次数
     2. 使用http2
        1. 解析速度快
        2. 多路复用
        3. 首部压缩
        4. 设置优先级
        5. 流量控制
        6. 服务器推送
  3. 静态资源使用cdn
  4. prefetch 预获取可能需要的资源
  5. preload 预获取必定要的资源, 重要资源使用
  6. cookie
     1. 减少cookie中存储的东西
     2. 静态资源不需要cookie，可以采用其他域名
- 少加载文件
  1. webpack优化
     1. 字体文件压缩
     2. webpack对文件压缩
        1. JavaScript：UglifyPlugin
        2. CSS ：MiniCssExtractPlugin
        3. HTML：HtmlWebpackPlugin
        4. 图片：image-webpack-loader
     3. 提取第三方库，webpack4 的 splitChunk 插件 cacheGroups 选项, 将多个三方库放在一个包中，再放到cdn上
     4. tree-shaking
     5. externals, CDN引入第三方库
  2. 图片优化
     1. 背景图轮播图等大图用jpg 
     2. 高质量图小图用png
     3. 懒加载
     4. 响应式图片，根据屏幕大小自动加载合适的图片
     5. 合理使用css效果代替
     6. 雪碧图，减少请求次数
     7. webp
  3. 缓存
     1. 强缓存、弱缓存
     2. Cache-Control / Expires / Max-Age 设置资源是否缓存，以及缓存时间
     3. Etag / If-None-Match 如果没变化则取缓存资源，状态码304 协商缓存
     4. Last-Modified / If-Modified-Since 通过对比时间的差异来觉得要不要从服务器获取资源
     5. 前端部署缓存实践
  4. gzip
     1. nginx配置 accept-encoding: gzip 开启gzip
  5. ssr, 减少首屏时间，利于seo
  6. lazy-load
  7. 使用iconfont代替图标图片
- 代码层面
  1. Vue
     1. 部分数据不做响应式
     2. 长列表虚拟滚动
     3. v-for避免同时用v-if
     4. 列表用唯一的key
     5. 合理使用v-show复用DOM
     6. 无状态组件, functional
     7. 子组件分割，避免父组件引发的不必要渲染
     8. 变量本地化，避免频繁触发getter
     9. 第三方插件按需引入
     10. 路由懒加载
     11. keep-alive缓存
     12. 定时器事件销毁，避免内存泄漏
     13. 图片懒加载
- 浏览器渲染相关
  1. 减少重绘重排
  2. 使用事件委托
  3. 60fps 与设备刷新率，requestAnimationFrame
  4. 降低css选择器复杂性
  5. 使用flex布局
- 用户体验
  1. 使用骨架屏
  2. 白屏loading
