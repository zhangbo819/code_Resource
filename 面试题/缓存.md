# 浏览器缓存策略

## 大纲

1. [强缓存](#强缓存)
   1. Expire
   2. Cache-Control 的值为 “public, max-age=xxx”
2. [协商缓存](#协商缓存)
   1. Etag/If-None-Match
   2. Last-Modifed/If-Modified-Since

## 强缓存

浏览器不会像服务器发送任何请求，直接从本地缓存中读取文件并返回

## 协商缓存

向服务器发送请求，服务器会根据这个请求的 request header 的一些参数来判断是否命中协商缓存，如果命中，则返回 304 状态码并带上新的 response header 通知浏览器从缓存中读取资源

- Last-Modifed / If-Modified-Since 的时间精度是秒，而 Etag 可以更精确。
- Etag 优先级是高于 Last-Modifed 的，所以服务器会优先验证 Etag
- Last-Modifed / If-Modified-Since 是 http1.0  的头字段

### Etag

Etag 是 属于 HTTP 1.1 属性，它是由服务器（Apache 或者其他工具）生成返回给前端，用来帮助服务器控制 Web 端的缓存验证。
Apache 中，ETag 的值，默认是对文件的索引节（INode），大小（Size）和最后修改时间（MTime）进行 Hash 后得到的。

Etag/If-None-Match 优先级高于 Last-Modifed/If-Modified-Since

### If-None-Match

再次请求服务器时，浏览器的请求报文头部会包含此字段，后面的值为在缓存中获取的标识。服务器接收到次报文后发现 If-None-Match 则与被请求资源的唯一标识进行对比

- 不同，说明资源被改动过，则响应整个资源内容，返回状态码 200。
- 相同，说明资源无心修改，则响应 header，浏览器直接从缓存中获取数据信息。返回状态码 304.

### Last-Modified

服务器在响应请求时，会告诉浏览器资源的最后修改时间。

### If-Modified-Since

浏览器再次请求服务器的时候，请求头会包含此字段，后面跟着在缓存中获得的最后修改时间。服务端收到此请求头发现有 if-Modified-Since，则与被请求资源的最后修改时间进行对比，如果一致则返回 304 和响应报文头，浏览器只需要从缓存中获取信息即可。

- 被修改：那么开始传输响应一个整体，服务器返回：200 OK
- 没有被修改：那么只需传输响应 header，服务器返回：304 Not Modified

## 参考链接

[外链 - 浏览器缓存知识梳理](https://juejin.cn/post/6947936223126093861)
[外链 - 面试题 -- 说下浏览器缓存策略](https://juejin.cn/post/7068583507844399134)